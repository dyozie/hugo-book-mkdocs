<!DOCTYPE html>
  
  
  
  
   <html class="no-js"> 

  <head lang="en-us">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=10" />
    <title>Using LDAP Authentication with TLS/SSL - Pivotal HDB</title>
    <meta name="generator" content="Hugo 0.36.1" />

    
    <link rel="canonical" href="https://example.org/clientaccess/ldap/">
    

    <meta property="og:url" content="https://example.org/clientaccess/ldap/">
    <meta property="og:title" content="Pivotal HDB">
    <meta property="og:image" content="https://example.org/images/logo.png">
    <meta name="apple-mobile-web-app-title" content="Pivotal HDB">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <link rel="shortcut icon" type="image/x-icon" href="https://example.org/images/favicon.ico">
    <link rel="icon" type="image/x-icon" href="https://example.org/images/favicon.ico">

    <style>
      @font-face {
        font-family: 'Icon';
        src: url('https://example.org/fonts/icon.eot');
        src: url('https://example.org/fonts/icon.eot')
               format('embedded-opentype'),
             url('https://example.org/fonts/icon.woff')
               format('woff'),
             url('https://example.org/fonts/icon.ttf')
               format('truetype'),
             url('https://example.org/fonts/icon.svg')
               format('svg');
        font-weight: normal;
        font-style: normal;
      }
    </style>

    <link rel="stylesheet" href="https://example.org/stylesheets/application.css">
    <link rel="stylesheet" href="https://example.org/stylesheets/temporary.css">
    <link rel="stylesheet" href="https://example.org/stylesheets/palettes.css">
    <link rel="stylesheet" href="https://example.org/stylesheets/highlight/highlight.css">

    
    
    
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Ubuntu:400,700|Ubuntu&#43;Mono">
    <style>
      body, input {
        font-family: 'Ubuntu', Helvetica, Arial, sans-serif;
      }
      pre, code {
        font-family: 'Ubuntu Mono', 'Courier New', 'Courier', monospace;
      }
    </style>

    
    <script src="https://example.org/javascripts/modernizr.js"></script>

    

  </head>
  <body class="palette-primary-teal palette-accent-deep orange">




<div class="backdrop">
	<div class="backdrop-paper"></div>
</div>

<input class="toggle" type="checkbox" id="toggle-drawer">
<input class="toggle" type="checkbox" id="toggle-search">
<label class="toggle-button overlay" for="toggle-drawer"></label>

<header class="header">
	<nav aria-label="Header">
  <div class="bar default">
    <div class="button button-menu" role="button" aria-label="Menu">
      <label class="toggle-button icon icon-menu" for="toggle-drawer">
        <span></span>
      </label>
    </div>
    <div class="stretch">
      <div class="title">
        Using LDAP Authentication with TLS/SSL
      </div>
    </div>

    

    
    
        
  </div>
  <div class="bar search">
    <div class="button button-close" role="button" aria-label="Close">
      <label class="toggle-button icon icon-back" for="toggle-search"></label>
    </div>
    <div class="stretch">
      <div class="field">
        <input class="query" type="text" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck>
      </div>
    </div>
    <div class="button button-reset" role="button" aria-label="Search">
      <button class="toggle-button icon icon-close" id="reset-search"></button>
    </div>
  </div>
</nav>
</header>

<main class="main">
	<div class="drawer">
		<nav aria-label="Navigation">
  <a href="https://example.org/" class="project">
    <div class="banner">
      
        <div class="logo">
          <img src="https://example.org/images/logo.png">
        </div>
      
      <div class="name">
        <strong>Pivotal HDB <span class="version">1.0.0</span></strong>
        
      </div>
    </div>
  </a>

  <div class="scrollable">
    <div class="wrapper">
      

      <div class="toc">
        
        <ul>
          




<li>
  
    



<a  title="Ambari Administration" href="https://example.org/admin/ambari-admin">
	
	Ambari Administration
</a>



  
</li>



<li>
  
    



<a  title="Ddls" href="https://example.org/ddl/">
	
	Ddls
</a>



  
</li>



<li>
  
    



<a  title="Managing Client Access" href="https://example.org/clientaccess/">
	
	Managing Client Access
</a>



  
</li>



<li>
  
    



<a  title="Pivotal HDB Docs" href="https://example.org/">
	
	Pivotal HDB Docs
</a>



  
</li>



<li>
  
    



<a  title="Plexts" href="https://example.org/plext/">
	
	Plexts
</a>



  
</li>



<li>
  
    



<a  title="Pxfs" href="https://example.org/pxf/">
	
	Pxfs
</a>



  
</li>



<li>
  
    



<a  title="Queries" href="https://example.org/query/">
	
	Queries
</a>



  
</li>



<li>
  
    



<a  title="Requirements" href="https://example.org/requirements/">
	
	Requirements
</a>



  
</li>



<li>
  
    



<a  title="Troubleshootings" href="https://example.org/troubleshooting/">
	
	Troubleshootings
</a>



  
</li>



<li>
  
    



<a  title="Tutorials" href="https://example.org/tutorial/">
	
	Tutorials
</a>



  
</li>


        </ul>
        

        
      </div>
    </div>
  </div>
</nav>

	</div>

	<article class="article">
		<div class="wrapper">
			<h1>Using LDAP Authentication with TLS/SSL </h1>

			

<!--
Licensed to the Apache Software Foundation (ASF) under one
or more contributor license agreements.  See the NOTICE file
distributed with this work for additional information
regarding copyright ownership.  The ASF licenses this file
to you under the Apache License, Version 2.0 (the
"License"); you may not use this file except in compliance
with the License.  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing,
software distributed under the License is distributed on an
"AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, either express or implied.  See the License for the
specific language governing permissions and limitations
under the License.
-->

<p>You can control access to HAWQ with an LDAP server and, optionally, secure the connection with encryption by adding parameters to pg_hba.conf file entries.</p>

<p>HAWQ supports LDAP authentication with the TLS/SSL protocol to encrypt communication with an LDAP server:</p>

<ul>
<li>LDAP authentication with STARTTLS and TLS protocol – STARTTLS starts with a clear text connection (no encryption) and upgrades it to a secure connection (with encryption).</li>
<li>LDAP authentication with a secure connection and TLS/SSL (LDAPS) – HAWQ uses the TLS or SSL protocol based on the protocol that is used by the LDAP server.</li>
</ul>

<p>If no protocol is specified, HAWQ communicates with the LDAP server with a clear text connection.</p>

<p>To use LDAP authentication, the HAWQ master host must be configured as an LDAP client. See your LDAP documentation for information about configuring LDAP clients.</p>

<h2 id="enabing-ldap-authentication-with-starttls-and-tls">Enabing LDAP Authentication with STARTTLS and TLS</h2>

<p>To enable STARTTLS with the TLS protocol, specify the <code>ldaptls</code> parameter with the value 1. The default port is 389. In this example, the authentication method parameters include the <code>ldaptls</code> parameter.</p>

<pre><code>ldap ldapserver=ldap.example.com ldaptls=1 ldapprefix=&quot;uid=&quot; ldapsuffix=&quot;,ou=People,dc=example,dc=com&quot;
</code></pre>

<p>Specify a non-default port, with the <code>ldapport</code> parameter. In this example, the authentication method includes the <code>ldaptls</code> parameter and the <code>ldapport</code> parameter to specify the port 550.</p>

<pre><code>ldap ldapserver=ldap.example.com ldaptls=1 ldapport=500 ldapprefix=&quot;uid=&quot; ldapsuffix=&quot;,ou=People,dc=example,dc=com&quot;
</code></pre>

<h2 id="enabling-ldap-authentication-with-a-secure-connection-and-tls-ssl">Enabling LDAP Authentication with a Secure Connection and TLS/SSL</h2>

<p>To enable a secure connection with TLS/SSL, add <code>ldaps://</code> as the prefix to the LDAP server name specified in the <code>ldapserver</code> parameter. The default port is 636.</p>

<p>This example <code>ldapserver</code> parameter specifies a secure connection and the TLS/SSL protocol for the LDAP server <code>ldap.example.com</code>.</p>

<pre><code>ldapserver=ldaps://ldap.example.com
</code></pre>

<p>To specify a non-default port, add a colon (:) and the port number after the LDAP server name. This example <code>ldapserver</code> parameter includes the <code>ldaps://</code> prefix and the non-default port 550.</p>

<pre><code>ldapserver=ldaps://ldap.example.com:550
</code></pre>

<h3 id="notes">Notes</h3>

<p>HAWQ logs an error if the following are specified in a pg_hba.conf file entry:</p>

<ul>
<li>If both the <code>ldaps://</code> prefix and the <code>ldaptls=1</code> parameter are specified.</li>
<li>If both the <code>ldaps://</code> prefix and the <code>ldapport</code> parameter are specified.</li>
</ul>

<p>Enabling encrypted communication for LDAP authentication only encrypts the communication between HAWQ and the LDAP server.</p>

<h2 id="configuring-authentication-with-a-system-wide-openldap-system">Configuring Authentication with a System-wide OpenLDAP System</h2>

<p>If you have a system-wide OpenLDAP system and logins are configured to use LDAP with TLS or SSL in the pg_hba.conf file, logins may fail with the following message:</p>

<pre><code class="language-shell">could not start LDAP TLS session: error code '-11'
</code></pre>

<p>To use an existing OpenLDAP system for authentication, HAWQ must be set up to use the LDAP server&rsquo;s CA certificate to validate user certificates. Follow these steps on both the master and standby hosts to configure HAWQ:</p>

<ol>
<li><p>Copy the base64-encoded root CA chain file from the Active Directory or LDAP server to
the HAWQ master and standby master hosts. This example uses the directory <code>/etc/pki/tls/certs</code>.</p></li>

<li><p>Change to the directory where you copied the CA certificate file and, as the root user, generate the hash for OpenLDAP:</p>

<pre><code># cd /etc/pki/tls/certs
# openssl x509 -noout -hash -in &lt;ca-certificate-file&gt;
# ln -s &lt;ca-certificate-file&gt; &lt;ca-certificate-file&gt;.0
</code></pre></li>

<li><p>Configure an OpenLDAP configuration file for HAWQ with the CA certificate directory and certificate file specified.</p>

<p>As the root user, edit the OpenLDAP configuration file <code>/etc/openldap/ldap.conf</code>:</p>

<pre><code>SASL_NOCANON on
URI ldaps://ldapA.example.priv ldaps://ldapB.example.priv ldaps://ldapC.example.priv
BASE dc=example,dc=priv
TLS_CACERTDIR /etc/pki/tls/certs
TLS_CACERT /etc/pki/tls/certs/&lt;ca-certificate-file&gt;
</code></pre>

<p><strong>Note</strong>: For certificate validation to succeed, the hostname in the certificate must match a hostname in the URI property. Otherwise, you must also add <code>TLS_REQCERT allow</code> to the file.</p></li>

<li><p>As the gpadmin user, edit <code>/usr/local/hawq/greenplum_path.sh</code> and add the following line.</p>

<pre><code class="language-bash">export LDAPCONF=/etc/openldap/ldap.conf
</code></pre></li>
</ol>

<h2 id="examples">Examples</h2>

<p>These are example entries from an pg_hba.conf file.</p>

<p>This example specifies LDAP authentication with no encryption between HAWQ and the LDAP server.</p>

<pre><code>host all plainuser 0.0.0.0/0 ldap ldapserver=ldap.example.com ldapprefix=&quot;uid=&quot; ldapsuffix=&quot;,ou=People,dc=example,dc=com&quot;
</code></pre>

<p>This example specifies LDAP authentication with the STARTTLS and TLS protocol between HAWQ and the LDAP server.</p>

<pre><code>host all tlsuser 0.0.0.0/0 ldap ldapserver=ldap.example.com ldaptls=1 ldapprefix=&quot;uid=&quot; ldapsuffix=&quot;,ou=People,dc=example,dc=com&quot;
</code></pre>

<p>This example specifies LDAP authentication with a secure connection and TLS/SSL protocol between HAWQ and the LDAP server.</p>

<pre><code>host all ldapsuser 0.0.0.0/0 ldap ldapserver=ldaps://ldap.example.com ldapprefix=&quot;uid=&quot; ldapsuffix=&quot;,ou=People,dc=example,dc=com&quot;
</code></pre>


			<aside class="copyright" role="note">
				
				Documentation built with
				<a href="https://www.gohugo.io" target="_blank">Hugo</a>
				using the
				<a href="http://github.com/digitalcraftsman/hugo-material-docs" target="_blank">Material</a> theme.
			</aside>

			<footer class="footer">
				

<nav class="pagination" aria-label="Footer">
  <div class="previous">
  
      <a href="https://example.org/clientaccess/kerberos/" title="Using Kerberos Authentication">
        <span class="direction">
          Previous
        </span>
        <div class="page">
          <div class="button button-previous" role="button" aria-label="Previous">
            <i class="icon icon-back"></i>
          </div>
          <div class="stretch">
            <div class="title">
              Using Kerberos Authentication
            </div>
          </div>
        </div>
      </a>
  
  </div>

  <div class="next">
  
      <a href="https://example.org/plext/usingprocedurallanguages/" title="Using Languages and Extensions in HAWQ">
        <span class="direction">
          Next
        </span>
        <div class="page">
          <div class="stretch">
            <div class="title">
              Using Languages and Extensions in HAWQ
            </div>
          </div>
          <div class="button button-next" role="button" aria-label="Next">
            <i class="icon icon-forward"></i>
          </div>
        </div>
      </a>
  
  </div>
</nav>





			</footer>
		</div>
	</article>

	<div class="results" role="status" aria-live="polite">
		<div class="scrollable">
			<div class="wrapper">
				<div class="meta"></div>
				<div class="list"></div>
			</div>
		</div>
	</div>
</main>

    <script>
    
      var base_url = '';
      var repo_id  = '';
    
    </script>

    <script src="https://example.org/javascripts/application.js"></script>
    

    <script>
      /* Add headers to scrollspy */
      var headers   = document.getElementsByTagName("h2");
      var scrollspy = document.getElementById('scrollspy');

      if(scrollspy) {
        if(headers.length > 0) {
          for(var i = 0; i < headers.length; i++) {
            var li = document.createElement("li");
            li.setAttribute("class", "anchor");

            var a  = document.createElement("a");
            a.setAttribute("href", "#" + headers[i].id);
            a.setAttribute("title", headers[i].innerHTML);
            a.innerHTML = headers[i].innerHTML;

            li.appendChild(a)
            scrollspy.appendChild(li);
          }
        } else {
          scrollspy.parentElement.removeChild(scrollspy)
        }


        /* Add permanent link next to the headers */
        var headers = document.querySelectorAll("h1, h2, h3, h4, h5, h6");

        for(var i = 0; i < headers.length; i++) {
            var a = document.createElement("a");
            a.setAttribute("class", "headerlink");
            a.setAttribute("href", "#" + headers[i].id);
            a.setAttribute("title", "Permanent link")
            a.innerHTML = "#";
            headers[i].appendChild(a);
        }
      }
    </script>

    

    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.8.0/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
  </body>
</html>

